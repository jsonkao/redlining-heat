---
title: "Analysis"
output: html_document
---

```{r setup, include=FALSE}
library(foreign)
library(jsonlite)
library(dplyr)
library(ggplot2)
```

## Read in data

```{r}
data <- inner_join(
  read.dbf('../data/fullshpfile/shapefile/holc_ad_data.dbf'),
  fromJSON('../data/temperatures.json'),
  by = c('neighborho' = 'id')
) %>% 
  rename(holc_grade = holc_grade.x) %>% 
  filter(holc_grade != 'E') %>% 
  select(state, city, holc_grade, temperature)
head(data)
```

## Visualize data

```{r}
data %>% ggplot(aes(temperature)) +
  geom_density() +
  facet_wrap(~ holc_grade)
```

## Tukey-Kramer test

```{r}
as.data.frame(TukeyHSD(aov(temperature ~ holc_grade, data = data %>% filter(city == 'Chicago')))$holc_grade)

ggsave(
  'test.png',
  data %>%
    filter(city == "Chicago") %>%
    ggplot(aes(temperature, fill = holc_grade)) +
    geom_density(alpha = 0.6) +
    facet_wrap( ~ holc_grade, ncol = 1) +
    theme_minimal_vgrid(12) +
    scale_y_continuous(expand = expansion(mult = c(0, 0.05))) +
    #panel_border() +
    theme(text = element_text(size = 12), axis.text = element_text(size = 9.2)) +
    guides(fill = FALSE) +
    scale_fill_manual(values = c(
      "#76a865", "#7cb5bd", "#ffff00", "#d9838d"
    )) +
    theme(axis.line.y = element_blank(), axis.text.y = element_blank(), axis.ticks.y = element_blank(), axis.title.y = element_blank()),
  device = 'png',
  width = 3,
  height = 6,
  units = 'in',
  dpi = 600
  )
```


